<!DOCTYPE html>
<!--
* CoreUI Free React.js Admin Template
* @version v5.4.0
* @link https://coreui.io/product/free-react-admin-template/
* Copyright (c) 2025 creativeLabs Łukasz Holeczek
* Licensed under MIT (https://github.com/coreui/coreui-free-react-admin-template/blob/main/LICENSE)
-->
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,CSS,SCSS,HTML,RWD,Dashboard,React">
  <title>Elcop Adm</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="shortcut icon" href="/src/assets/images/logoGoogle.png">
  <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.0.0/dist/js/coreui.bundle.min.js"></script>
  <!-- Script de contorno de certificado desativado para evitar conflitos -->
  <!-- <script src="/bypass-certificate.js"></script> -->
  
  <!-- Configurações avançadas para contornar erros de certificado em todos os ambientes -->
  <script>
    // Configuração de segurança e gerenciamento de certificados
    function setupAdvancedSecurityBypass() {
      console.log('� Inicializando configurações avançadas de segurança...');
      
      try {
        // === CONTENT SECURITY POLICY ===
        
        // 1. Permitir requisições inseguras quando necessário
        const metaUpgrade = document.createElement('meta');
        metaUpgrade.httpEquiv = 'Content-Security-Policy';
        metaUpgrade.content = 'upgrade-insecure-requests';
        document.head.appendChild(metaUpgrade);
        
        // 2. Configurar permissões de conexão para API específica
        const metaConnect = document.createElement('meta');
        metaConnect.httpEquiv = 'Content-Security-Policy';
        metaConnect.content = "connect-src https://10.10.0.13:* http://10.10.0.13:* https://*.elcop.eng.br:* http://*.elcop.eng.br:* 'self'";
        document.head.appendChild(metaConnect);
        
        // 3. Permitir scripts em linha (necessário para alguns recursos)
        const metaScript = document.createElement('meta');
        metaScript.httpEquiv = 'Content-Security-Policy';
        metaScript.content = "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net";
        document.head.appendChild(metaScript);
        
        // === DETECÇÃO DE AMBIENTE ===
        const isProduction = window.location.port === '6443' || window.location.hostname.includes('adm.elcop');
        const environment = isProduction ? 'Produção' : 'Desenvolvimento';
        console.log(`🔐 Ambiente detectado: ${environment}`);
        
        // === MANIPULAÇÃO DE ERROS ===
        // Interceptar erros de certificado SSL não tratados
        window.addEventListener('unhandledrejection', function(event) {
          // Verificar se o erro está relacionado a certificado SSL
          if (event.reason && typeof event.reason.message === 'string' && 
              (event.reason.message.includes('certificate') || 
               event.reason.message.includes('SSL') || 
               event.reason.message.includes('ERR_CERT'))) {
            
            console.warn('🔐 Erro de certificado interceptado:', event.reason.message);
            
            // Registrar no localStorage para diagnóstico
            try {
              const sslErrors = JSON.parse(localStorage.getItem('ssl_errors') || '[]');
              sslErrors.push({
                time: new Date().toISOString(),
                message: event.reason.message,
                url: window.location.href
              });
              localStorage.setItem('ssl_errors', JSON.stringify(sslErrors.slice(-10))); // Manter apenas os 10 últimos
            } catch (e) {
              console.error('Erro ao registrar problema SSL:', e);
            }
            
            // Notificar uma única vez por sessão
            if (!window.sslErrorNotified) {
              window.sslErrorNotified = true;
              console.log('🔐 Problema de segurança detectado. Utilizando conexão alternativa.');
            }
            
            // Prevenir que o erro apareça como não tratado
            event.preventDefault();
          }
        });
        
        // === MONITORAMENTO DE REDE ===
        // Monitorar estado da conexão
        window.addEventListener('online', () => {
          console.log('🔐 Conexão de rede restabelecida');
          // Recarregar recursos que possam ter falhado
          document.dispatchEvent(new CustomEvent('network:online'));
        });
        
        window.addEventListener('offline', () => {
          console.log('🔐 Conexão de rede perdida');
          document.dispatchEvent(new CustomEvent('network:offline'));
        });
        
        console.log('🔐 Configurações avançadas de segurança inicializadas com sucesso');
      } catch (error) {
        console.error('🔐 Erro ao configurar bypass de segurança:', error);
      }
    }
    
    // Iniciar configuração
    setupAdvancedSecurityBypass();
  </script>
</head>

<body>
  <noscript>
    You need to enable JavaScript to run this app
  </noscript>
  <div id="root"></div>
  <script type="module" src="/src/index.js"></script>
  <!-- built files will be auto injected -->
</body>

</html>